<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0b0d1a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="–ù–µ–π—Ä–æ—Ñ–∏–Ω–∞–Ω—Å—ã">
  <meta name="description" content="–£–º–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º —á–µ–∫–æ–≤">
  <title>–ù–µ–π—Ä–æ—Ñ–∏–Ω–∞–Ω—Å—ã ¬∑ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä</title>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="icon" type="image/png" href="/icons/icon-192.png">
  
  <!-- Tesseract.js –¥–ª—è OCR -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/4.0.2/tesseract.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
    }

    body {
      background: #0b0d1a;
      color: #f0f3ff;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overscroll-behavior-y: contain;
      touch-action: pan-y;
    }

    /* –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö) */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at 30% 40%, #1f2b6b, #0b0b1a 70%);
      animation: rotate 80s linear infinite;
      z-index: -2;
      will-change: transform;
    }
    body::after {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 70% 20%, rgba(100, 150, 255, 0.1) 0%, transparent 60%);
      z-index: -1;
    }
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    .app {
      width: 100%;
      max-width: 100%;
      margin: 0 auto;
      padding: 12px 12px 80px; /* –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: relative;
      z-index: 10;
    }

    /* —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ */
    .card {
      background: rgba(15, 18, 35, 0.85);
      backdrop-filter: blur(16px) saturate(150%);
      -webkit-backdrop-filter: blur(16px) saturate(150%);
      border: 1px solid rgba(110, 140, 255, 0.25);
      border-radius: 28px;
      padding: 18px 16px;
      box-shadow: 0 8px 24px -6px #00000080;
      width: 100%;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(100, 150, 255, 0.4), transparent);
    }

    /* –≤—Å–µ –ø–æ–ª—è –≤–≤–æ–¥–∞, select, –∫–Ω–æ–ø–∫–∏ ‚Äî –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ */
    .field, .btn, .type-opt, .scan-btn, .btn-clear, .budget-input, select.input, input.input, .budget-msg {
      width: 100%;
      background: #161e3c;
      border: 2px solid #334180;
      border-radius: 56px;
      padding: 16px 20px;
      font-size: 1.15rem;
      color: white;
      outline: none;
      transition: all 0.15s ease;
      appearance: none;
      min-height: 56px;
      font-weight: 500;
    }

    /* –∫–Ω–æ–ø–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ */
    .btn, .btn-clear, .scan-btn, .type-opt {
      text-align: center;
      font-weight: 600;
      cursor: pointer;
      background: #1f2952;
      border-color: #5f72ce;
      user-select: none;
      touch-action: manipulation;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .btn::after, .btn-clear::after, .scan-btn::after, .type-opt::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 0;
    }
    
    .btn:active::after, .btn-clear:active::after, .scan-btn:active::after, .type-opt:active::after {
      opacity: 1;
    }
    
    .btn span, .btn-clear span, .scan-btn span, .type-opt span {
      position: relative;
      z-index: 1;
    }

    .btn:active, .btn-clear:active, .scan-btn:active, .type-opt:active {
      transform: scale(0.97);
      border-color: #7a8bff;
    }
    
    .type-opt.active {
      background: linear-gradient(145deg, #4a5ac0, #2a3572);
      border-color: #b1acff;
      color: white;
      box-shadow: 0 0 12px rgba(91, 106, 224, 0.5);
    }
    
    /* –¥–ª—è select —É–±–∏—Ä–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —Å—Ç—Ä–µ–ª–∫—É, –¥–æ–±–∞–≤–∏–º —Å–≤–æ—é */
    select {
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23aab7f0' stroke-width='2'><polyline points='6 9 12 15 18 9'/></svg>");
      background-repeat: no-repeat;
      background-position: right 18px center;
      background-size: 18px;
      padding-right: 40px;
    }

    /* —à–∞–ø–∫–∞ */
    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      text-align: center;
    }
    .header h1 {
      font-size: 1.9rem;
      font-weight: 700;
      background: linear-gradient(145deg, #e0d7ff, #adc4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: -0.5px;
      flex: 1;
    }
    .header-icon {
      font-size: 2.4rem;
      min-width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* —Å–≤–æ–¥–∫–∞ */
    .summary-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .summary-item {
      background: #10152f;
      border-radius: 24px;
      padding: 14px 4px;
      text-align: center;
      border: 1px solid #394894;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .summary-label {
      font-size: 0.85rem;
      color: #b5c8ff;
      margin-bottom: 4px;
    }
    .summary-value {
      font-size: 1.45rem;
      font-weight: 700;
      line-height: 1.2;
    }
    .income-val { color: #a0ecb0; }
    .expense-val { color: #ffafaf; }
    .balance-val { color: #dbbaff; }

    /* –±—é–¥–∂–µ—Ç */
    .budget-title {
      font-size: 1.45rem;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
    }
    .budget-msg {
      background: #121937;
      border-color: #6f86f0;
      text-align: center;
      font-weight: 500;
      margin-top: 10px;
      min-height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 16px;
      line-height: 1.4;
    }
    .budget-msg strong {
      color: #fff;
      font-weight: 700;
    }

    /* —Ñ–æ—Ä–º–∞ */
    .row {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 8px;
    }
    .type-switch {
      display: flex;
      gap: 10px;
      margin: 8px 0;
    }
    .type-opt {
      flex: 1;
      padding: 14px 8px;
      font-size: 1.05rem;
      min-height: 52px;
    }
    .category-wrap.hidden {
      display: none;
    }
    
    label {
      display: block;
      margin-left: 4px;
      margin-bottom: 6px;
      font-size: 0.95rem;
      color: #c3d1ff;
      font-weight: 500;
    }

    /* —Å–∫–∞–Ω–µ—Ä */
    .scan-block {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .scan-btn {
      flex: 1 1 100%;
      padding: 16px;
      font-size: 1.15rem;
      min-height: 56px;
    }
    .ocr-text {
      width: 100%;
      background: #121b3d;
      border-radius: 24px;
      padding: 16px;
      border: 2px solid #4456af;
      color: #cadaff;
      font-size: 1.05rem;
      min-height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      line-height: 1.4;
      margin-top: 8px;
    }
    
    .ocr-loading {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .ocr-loading::after {
      content: '';
      width: 16px;
      height: 16px;
      border: 2px solid #5f72ce;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* –≥—Ä–∞—Ñ–∏–∫ */
    .chart-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    .chart-title {
      width: 100%;
      text-align: left;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    canvas#categoryChart {
      width: 200px;
      height: 200px;
      max-width: 100%;
      background: #101633;
      border-radius: 50%;
      box-shadow: 0 0 24px rgba(60, 71, 144, 0.6);
      display: block;
    }
    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      justify-content: center;
      margin-top: 8px;
      max-width: 100%;
      padding: 0 8px;
    }
    .legend-item {
      background: rgba(26, 34, 74, 0.7);
      border-radius: 32px;
      padding: 6px 16px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.95rem;
      white-space: nowrap;
      max-width: 45%;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 6px;
      flex-shrink: 0;
    }

    /* —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π */
    .list {
      max-height: 320px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
      padding-right: 4px;
      scrollbar-width: thin;
      scrollbar-color: #3a4cb5 #1a224a;
    }
    .list::-webkit-scrollbar {
      width: 6px;
    }
    .list::-webkit-scrollbar-track {
      background: #1a224a;
      border-radius: 10px;
    }
    .list::-webkit-scrollbar-thumb {
      background-color: #3a4cb5;
      border-radius: 10px;
    }
    .tx-item {
      background: #121b3f;
      border-radius: 24px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      border: 1px solid #4a5cad;
      position: relative;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      min-height: 72px;
    }
    .tx-item:active {
      transform: scale(0.99);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .tx-left {
      flex: 1;
      min-width: 0;
      padding-right: 8px;
    }
    .tx-left .tx-desc {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .tx-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 8px 12px;
      font-size: 0.95rem;
      color: #b3c6ff;
      line-height: 1.4;
    }
    .tx-amount {
      font-size: 1.55rem;
      font-weight: 700;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      min-width: 90px;
      text-align: right;
      padding-left: 8px;
    }
    .income-tx { color: #9df0b1; }
    .expense-tx { color: #ffa7a7; }
    .delete-btn {
      background: #552f4b;
      border: none;
      border-radius: 36px;
      width: 48px;
      height: 48px;
      min-width: 48px;
      font-size: 1.35rem;
      color: white;
      cursor: pointer;
      touch-action: manipulation;
      margin-top: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      flex-shrink: 0;
    }
    .delete-btn:active {
      background: #7a3a5e;
      transform: scale(0.92);
    }
    .footer-bar {
      display: flex;
      justify-content: space-between;
      margin-top: 12px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .btn-clear {
      width: auto;
      padding: 14px 24px;
      background: #262f5a;
      min-height: 52px;
      font-size: 1.05rem;
    }
    .empty-list {
      text-align: center;
      padding: 36px 20px;
      color: #9aabdf;
      line-height: 1.5;
    }
    
    .empty-list-icon {
      font-size: 3rem;
      margin-bottom: 12px;
      display: block;
    }

    /* —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
    .notification {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(30, 40, 80, 0.95);
      border: 2px solid #5f72ce;
      border-radius: 28px;
      padding: 14px 24px;
      color: white;
      font-weight: 500;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
      max-width: 90%;
      text-align: center;
    }
    .notification.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }
    .notification.success { border-color: #4caf50; }
    .notification.error { border-color: #ff5252; }
    .notification.warning { border-color: #ffca28; }

    /* –∑–∞–≥—Ä—É–∑–∫–∞ */
    .loading {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(11, 13, 26, 0.92);
      backdrop-filter: blur(8px);
      z-index: 2000;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 24px;
    }
    .loading.show {
      display: flex;
    }
    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(100, 150, 255, 0.3);
      border-top-color: #6496ff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    .loading-text {
      color: white;
      font-size: 1.4rem;
      font-weight: 500;
      text-align: center;
      max-width: 80%;
      line-height: 1.4;
    }

    /* –≤—Å—ë –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ, –∫–Ω–æ–ø–∫–∏ –æ–≥—Ä–æ–º–Ω—ã–µ */
    @media (max-width: 400px) {
      .field, .btn, .type-opt, .scan-btn, .budget-input, select, input, .budget-msg {
        padding: 14px 16px;
        font-size: 1.05rem;
        border-radius: 52px;
        min-height: 52px;
      }
      .header h1 { 
        font-size: 1.7rem;
        letter-spacing: -0.3px;
      }
      .header-icon {
        font-size: 2.2rem;
        min-width: 44px;
        height: 44px;
      }
      .summary-value { font-size: 1.3rem; }
      .summary-label { font-size: 0.8rem; }
      .summary-item { min-height: 76px; padding: 12px 4px; }
      .budget-title { font-size: 1.35rem; }
      .type-opt { padding: 12px 6px; font-size: 1rem; min-height: 48px; }
      .btn-clear { padding: 12px 20px; font-size: 1rem; min-height: 48px; }
      .tx-left .tx-desc { font-size: 1.15rem; }
      .tx-meta { font-size: 0.9rem; }
      .tx-amount { font-size: 1.45rem; min-width: 80px; }
      .delete-btn { width: 44px; height: 44px; font-size: 1.25rem; }
      .app { padding: 10px 10px 70px; }
      .card { border-radius: 24px; padding: 16px 14px; }
      canvas#categoryChart { width: 180px; height: 180px; }
      .legend-item { padding: 5px 14px; font-size: 0.9rem; }
      .legend-color { width: 14px; height: 14px; }
      .chart-title { font-size: 1.4rem; }
      .ocr-text { font-size: 1rem; min-height: 52px; padding: 14px; }
      .scan-btn { padding: 14px; font-size: 1.1rem; }
      .list { max-height: 280px; }
    }
    
    @media (max-width: 320px) {
      .field, .btn, .type-opt, .scan-btn, .budget-input, select, input, .budget-msg {
        padding: 12px 14px;
        font-size: 1rem;
        min-height: 48px;
      }
      .header h1 { font-size: 1.55rem; }
      .header-icon { font-size: 2rem; min-width: 40px; height: 40px; }
      .summary-value { font-size: 1.2rem; }
      .summary-label { font-size: 0.75rem; }
      .summary-item { min-height: 72px; padding: 10px 4px; }
      .budget-title { font-size: 1.25rem; }
      .type-opt { padding: 10px 4px; font-size: 0.95rem; min-height: 44px; }
      .btn-clear { padding: 10px 16px; font-size: 0.95rem; min-height: 44px; }
      .tx-left .tx-desc { font-size: 1.05rem; }
      .tx-meta { font-size: 0.85rem; gap: 6px 10px; }
      .tx-amount { font-size: 1.35rem; min-width: 75px; }
      .delete-btn { width: 40px; height: 40px; font-size: 1.15rem; }
      .app { padding: 8px 8px 65px; }
      .card { border-radius: 20px; padding: 14px 12px; }
      canvas#categoryChart { width: 160px; height: 160px; }
      .legend-item { padding: 4px 12px; font-size: 0.85rem; max-width: 48%; }
      .legend-color { width: 12px; height: 12px; }
      .chart-title { font-size: 1.3rem; }
      .ocr-text { font-size: 0.95rem; min-height: 48px; padding: 12px; }
      .scan-btn { padding: 12px; font-size: 1.05rem; }
      .list { max-height: 260px; }
      .budget-msg { font-size: 0.95rem; min-height: 52px; }
      .empty-list { padding: 30px 16px; font-size: 0.95rem; }
      .empty-list-icon { font-size: 2.6rem; }
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .card {
      animation: fadeInUp 0.4s ease-out forwards;
      opacity: 0;
    }
    
    .card:nth-child(1) { animation-delay: 0.1s; opacity: 0; }
    .card:nth-child(2) { animation-delay: 0.15s; opacity: 0; }
    .card:nth-child(3) { animation-delay: 0.2s; opacity: 0; }
    .card:nth-child(4) { animation-delay: 0.25s; opacity: 0; }
    .card:nth-child(5) { animation-delay: 0.3s; opacity: 0; }
    .card:nth-child(6) { animation-delay: 0.35s; opacity: 0; }
    .card:nth-child(7) { animation-delay: 0.4s; opacity: 0; }
    
    .card.visible {
      opacity: 1;
    }
    
    /* –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ñ–æ–∫—É—Å–∞ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ */
    .field:focus, .btn:focus, .type-opt:focus, .scan-btn:focus, select:focus {
      border-color: #7a8bff;
      box-shadow: 0 0 0 2px rgba(122, 139, 255, 0.3);
    }
  </style>
</head>
<body>
<div class="loading" id="loadingScreen">
  <div class="loading-spinner"></div>
  <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...<br>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–±–æ—Ç–µ</div>
</div>

<div class="notification" id="notification">
  <span id="notificationIcon"></span>
  <span id="notificationText"></span>
</div>

<div class="app">
  <!-- —à–∞–ø–∫–∞ -->
  <div class="card header visible">
    <div class="header-icon">üß†üí∞</div>
    <h1>–Ω–µ–π—Ä–æ—Ñ–∏–Ω–∞–Ω—Å—ã</h1>
  </div>

  <!-- —Å–≤–æ–¥–∫–∞ -->
  <div class="card summary-row visible">
    <div class="summary-item">
      <div class="summary-label">–î–æ—Ö–æ–¥—ã</div>
      <div class="summary-value income-val" id="totalIncome">0 ‚ÇΩ</div>
    </div>
    <div class="summary-item">
      <div class="summary-label">–†–∞—Å—Ö–æ–¥—ã</div>
      <div class="summary-value expense-val" id="totalExpense">0 ‚ÇΩ</div>
    </div>
    <div class="summary-item">
      <div class="summary-label">–ë–∞–ª–∞–Ω—Å</div>
      <div class="summary-value balance-val" id="totalBalance">0 ‚ÇΩ</div>
    </div>
  </div>

  <!-- –∞–≤—Ç–æ–±—é–¥–∂–µ—Ç -->
  <div class="card visible">
    <div class="budget-title"><span>ü§ñ</span> –æ—Å—Ç–∞—Ç–æ–∫ 5000‚ÇΩ —Å –∑–∞—Ä–ø–ª–∞—Ç—ã</div>
    <div style="margin-bottom: 12px;">
      <label for="salaryInput">üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞ (–≤ –º–µ—Å—è—Ü)</label>
      <input type="number" id="salaryInput" class="field budget-input" inputmode="numeric" value="30000" placeholder="30000">
    </div>
    <div style="margin-bottom: 12px;">
      <label for="nextSalaryDate">üìÖ –°–ª–µ–¥—É—é—â–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞</label>
      <input type="date" id="nextSalaryDate" class="field budget-input">
    </div>
    <div class="budget-msg" id="budgetMessage">‚ö° –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—é...</div>
  </div>

  <!-- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ -->
  <div class="card visible">
    <div class="row">
      <label for="descInput">–û–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
      <input type="text" id="descInput" class="field" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" autocomplete="off">
    </div>
    <div class="row">
      <label for="amountInput">–°—É–º–º–∞ –≤ —Ä—É–±–ª—è—Ö</label>
      <input type="number" id="amountInput" class="field" inputmode="decimal" placeholder="0.00" min="0" step="0.01" value="0.00">
    </div>
    <div class="type-switch" id="typeToggle">
      <div class="type-opt income active" data-type="income" role="button" tabindex="0">üíπ –î–æ—Ö–æ–¥</div>
      <div class="type-opt expense" data-type="expense" role="button" tabindex="0">üîª –†–∞—Å—Ö–æ–¥</div>
    </div>
    <div class="category-wrap" id="categoryBlock">
      <label for="categorySelect">–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤</label>
      <select id="categorySelect" class="field">
        <option value="–ï–¥–∞">üçî –ï–¥–∞</option>
        <option value="–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç">üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
        <option value="–ü–æ–∫—É–ø–∫–∏">üõçÔ∏è –ü–æ–∫—É–ø–∫–∏</option>
        <option value="–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è">üé¨ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</option>
        <option value="–ö–æ–º–º—É–Ω–∞–ª–∫–∞">üí° –ö–æ–º–º—É–Ω–∞–ª–∫–∞</option>
        <option value="–î—Ä—É–≥–æ–µ">üì¶ –î—Ä—É–≥–æ–µ</option>
      </select>
    </div>
    <div class="row">
      <label for="dateInput">–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
      <input type="date" id="dateInput" class="field">
    </div>
    <button class="btn" id="addTransactionBtn" aria-label="–î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –æ–ø–µ—Ä–∞—Ü–∏—é">
      <span>‚ûï</span> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å
    </button>
  </div>

  <!-- —Å–∫–∞–Ω–µ—Ä —á–µ–∫–∞ -->
  <div class="card visible">
    <div class="chart-title">üì∏ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫</div>
    <div class="scan-block">
      <input type="file" id="receiptImage" accept="image/*" capture="environment" style="display:none;">
      <button class="scan-btn" id="scanReceiptBtn" aria-label="–°–¥–µ–ª–∞—Ç—å —Ñ–æ—Ç–æ —á–µ–∫–∞">
        <span>üì∑</span> –°–Ω—è—Ç—å —á–µ–∫
      </button>
      <div class="ocr-text" id="ocrResult">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã —Å—Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞—Ç—å —á–µ–∫</div>
    </div>
  </div>

  <!-- –≥—Ä–∞—Ñ–∏–∫ -->
  <div class="card chart-container visible">
    <div class="chart-title">üìä –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
    <canvas id="categoryChart" width="200" height="200"></canvas>
    <div class="legend" id="chartLegend"></div>
  </div>

  <!-- —Å–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π -->
  <div class="card visible">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; flex-wrap: wrap; gap: 8px;">
      <span class="chart-title" style="margin:0;">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</span>
      <button class="btn-clear" id="clearAllBtn" aria-label="–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏">–æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
    </div>
    <div class="list" id="transactionList">
      <div class="empty-list">
        <span class="empty-list-icon">‚ú®</span>
        –ü–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π<br>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å!
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    document.getElementById('loadingScreen').classList.add('show');
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
    setTimeout(() => {
      document.getElementById('loadingScreen').classList.remove('show');
      
      // –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
      setTimeout(() => {
        document.querySelectorAll('.card').forEach((card, index) => {
          setTimeout(() => {
            card.classList.add('visible');
          }, 100 * index);
        });
      }, 300);
    }, 800);
    
    // --- –¥–∞–Ω–Ω—ã–µ ---
    let transactions = [];
    const categoryColors = {
      '–ï–¥–∞': '#f97373', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç': '#73b9f9', '–ü–æ–∫—É–ø–∫–∏': '#f9c573',
      '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è': '#c573f9', '–ö–æ–º–º—É–Ω–∞–ª–∫–∞': '#73f9cd', '–î—Ä—É–≥–æ–µ': '#b0b0b0'
    };

    function load() {
      const stored = localStorage.getItem('mobile_finance_v2');
      if (stored) {
        try { 
          transactions = JSON.parse(stored); 
        } catch { 
          transactions = []; 
          showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
        }
      } else {
        transactions = [
          { id: Date.now()-1000000, description: '–ó–∞—Ä–ø–ª–∞—Ç–∞', amount: 30000, category: '‚Äî', type: 'income', date: getTodayString() },
          { id: Date.now()-900000, description: '–ü—Ä–æ–¥—É–∫—Ç—ã', amount: 2500, category: '–ï–¥–∞', type: 'expense', date: getTodayString() },
          { id: Date.now()-800000, description: '–¢–∞–∫—Å–∏', amount: 600, category: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', type: 'expense', date: getTodayString() },
        ];
      }
    }
    
    function save() { 
      try {
        localStorage.setItem('mobile_finance_v2', JSON.stringify(transactions));
      } catch (e) {
        showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö', 'error');
      }
    }
    
    function getTodayString() { 
      const today = new Date();
      return today.toISOString().split('T')[0]; 
    }

    // --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã ---
    const totalIncomeEl = document.getElementById('totalIncome');
    const totalExpenseEl = document.getElementById('totalExpense');
    const totalBalanceEl = document.getElementById('totalBalance');
    const listEl = document.getElementById('transactionList');
    const addBtn = document.getElementById('addTransactionBtn');
    const descInput = document.getElementById('descInput');
    const amountInput = document.getElementById('amountInput');
    const dateInput = document.getElementById('dateInput');
    const categorySelect = document.getElementById('categorySelect');
    const categoryBlock = document.getElementById('categoryBlock');
    const typeOptions = document.querySelectorAll('.type-opt');
    const chartCanvas = document.getElementById('categoryChart');
    const chartLegend = document.getElementById('chartLegend');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const salaryInput = document.getElementById('salaryInput');
    const nextSalaryDate = document.getElementById('nextSalaryDate');
    const budgetMessage = document.getElementById('budgetMessage');
    const scanBtn = document.getElementById('scanReceiptBtn');
    const receiptImage = document.getElementById('receiptImage');
    const ocrResultDiv = document.getElementById('ocrResult');
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notificationText');
    const notificationIcon = document.getElementById('notificationIcon');

    let currentType = 'income';
    dateInput.value = getTodayString();

    // —Å–ª–µ–¥—É—é—â–∞—è –∑–∞—Ä–ø–ª–∞—Ç–∞ (–ø–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞)
    const defaultNext = new Date();
    defaultNext.setMonth(defaultNext.getMonth() + 1);
    defaultNext.setDate(1);
    nextSalaryDate.value = defaultNext.toISOString().split('T')[0];

    // --- –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∏–ø–∞ (–∏ click –∏ touchstart –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏) ---
    function setActiveType(type) {
      typeOptions.forEach(opt => {
        if (opt.dataset.type === type) {
          opt.classList.add('active');
        } else {
          opt.classList.remove('active');
        }
      });
      currentType = type;
      if (type === 'income') {
        categoryBlock.classList.add('hidden');
      } else {
        categoryBlock.classList.remove('hidden');
      }
      // –û–±–Ω–æ–≤–∏—Ç—å —Ñ–æ–∫—É—Å –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
      if (type === 'expense' && !categoryBlock.classList.contains('hidden')) {
        categorySelect.focus();
      }
    }

    typeOptions.forEach(opt => {
      function handler(e) {
        e.preventDefault();
        e.stopPropagation();
        setActiveType(opt.dataset.type);
      }
      opt.addEventListener('click', handler);
      opt.addEventListener('touchstart', handler, { passive: false });
      // –î–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
      opt.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          handler(e);
        }
      });
    });
    setActiveType('income'); // –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

    // --- –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ ---
    function addTransaction() {
      const description = descInput.value.trim();
      if (!description) { 
        showNotification('–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏', 'warning');
        descInput.focus();
        return; 
      }
      
      const amountStr = amountInput.value.trim();
      if (!amountStr) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –æ–ø–µ—Ä–∞—Ü–∏–∏', 'warning');
        amountInput.focus();
        return;
      }
      
      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—è—Ç–æ–π –∫–∞–∫ –¥–µ—Å—è—Ç–∏—á–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è
      const amountValue = parseFloat(amountStr.replace(',', '.'));
      if (isNaN(amountValue) || amountValue <= 0) { 
        showNotification('–°—É–º–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0', 'warning');
        amountInput.focus();
        return; 
      }
      
      const date = dateInput.value || getTodayString();
      let category = '–î—Ä—É–≥–æ–µ';
      if (currentType === 'expense') category = categorySelect.value;
      else category = '‚Äî';

      transactions.push({
        id: Date.now() + Math.random(),
        description, 
        amount: Math.round(amountValue * 100) / 100, // —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å –∫–æ–ø–µ–π–∫–∞–º–∏
        category, 
        type: currentType, 
        date
      });
      
      save();
      updateUI();
      
      // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
      descInput.value = '';
      amountInput.value = '0.00';
      dateInput.value = getTodayString();
      
      // –§–æ–∫—É—Å –Ω–∞ –æ–ø–∏—Å–∞–Ω–∏–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
      descInput.focus();
      
      showNotification(currentType === 'income' ? '–î–æ—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!' : '–†–∞—Å—Ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
    }
    
    function setupButton(element, callback) {
      element.addEventListener('click', (e) => {
        e.preventDefault();
        callback();
      });
      
      element.addEventListener('touchstart', (e) => { 
        e.preventDefault();
        callback();
      }, { passive: false });
      
      // –î–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
      element.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          callback();
        }
      });
    }
    
    setupButton(addBtn, addTransaction);

    // --- —É–¥–∞–ª–µ–Ω–∏–µ ---
    function deleteTransaction(id) {
      const originalLength = transactions.length;
      transactions = transactions.filter(t => t.id !== id);
      
      if (transactions.length < originalLength) {
        save();
        updateUI();
        showNotification('–û–ø–µ—Ä–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞', 'success');
      }
    }

    // --- –æ—á–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ ---
    setupButton(clearAllBtn, () => {
      if (transactions.length === 0) {
        showNotification('–ù–µ—á–µ–≥–æ —É–¥–∞–ª—è—Ç—å - —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç', 'warning');
        return;
      }
      
      // –ú–æ–¥–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
      if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
        transactions = [];
        save();
        updateUI();
        showNotification('–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —É–¥–∞–ª–µ–Ω—ã', 'success');
      }
    });

    // --- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ---
    function updateUI() {
      let inc = 0, exp = 0;
      transactions.forEach(t => t.type === 'income' ? inc += t.amount : exp += t.amount);
      totalIncomeEl.textContent = format(inc);
      totalExpenseEl.textContent = format(exp);
      totalBalanceEl.textContent = format(inc - exp);

      // —Å–ø–∏—Å–æ–∫
      const sorted = [...transactions].sort((a,b)=>new Date(b.date)-new Date(a.date));
      if (sorted.length === 0) {
        listEl.innerHTML = `
          <div class="empty-list">
            <span class="empty-list-icon">‚ú®</span>
            –ü–æ–∫–∞ –Ω–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π<br>–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å!
          </div>
        `;
      } else {
        let html = '';
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
        sorted.slice(0, 15).forEach(t => {
          const sign = t.type === 'income' ? '+' : '‚àí';
          const amountClass = t.type === 'income' ? 'income-tx' : 'expense-tx';
          html += `
            <div class="tx-item">
              <div class="tx-left">
                <div class="tx-desc">${escapeHtml(t.description)}</div>
                <div class="tx-meta">
                  <span>${formatDate(t.date)}</span>
                  ${t.type === 'expense' ? `<span>${t.category}</span>` : ''}
                </div>
              </div>
              <div class="tx-amount ${amountClass}">
                <span>${sign} ${format(t.amount)}</span>
                <button class="delete-btn" data-id="${t.id}" aria-label="–£–¥–∞–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é ${escapeHtml(t.description)}">
                  üóëÔ∏è
                </button>
              </div>
            </div>
          `;
        });
        listEl.innerHTML = html;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–¥–∞–ª–µ–Ω–∏—è
        document.querySelectorAll('.delete-btn').forEach(btn => {
          const id = Number(btn.dataset.id);
          
          setupButton(btn, () => {
            deleteTransaction(id);
          });
        });
      }

      // –≥—Ä–∞—Ñ–∏–∫
      drawPie();

      // –±—é–¥–∂–µ—Ç
      updateBudgetAdvice();
    }

    function format(v) { 
      // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å –¥–≤—É–º—è –∑–Ω–∞–∫–∞–º–∏ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π –¥–ª—è –∫–æ–ø–µ–µ–∫
      return (Math.round(v * 100) / 100).toLocaleString('ru-RU', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }) + ' ‚ÇΩ'; 
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }
    
    function escapeHtml(text) {
      if (!text) return '';
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // --- –∫—Ä—É–≥–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞ ---
    function drawPie() {
      const ctx = chartCanvas.getContext('2d');
      const w = chartCanvas.width, h = chartCanvas.height;
      const expCat = {};
      
      // –°–æ–±–∏—Ä–∞–µ–º —Ä–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
      transactions.forEach(t => { 
        if (t.type === 'expense') {
          expCat[t.category] = (expCat[t.category] || 0) + t.amount;
        }
      });
      
      const cats = Object.keys(expCat);
      const vals = Object.values(expCat);
      const total = vals.reduce((a,b)=>a+b,0);
      
      // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç
      ctx.clearRect(0,0,w,h);
      
      // –ï—Å–ª–∏ –Ω–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤
      if (total === 0) {
        ctx.fillStyle = '#1c234a';
        ctx.beginPath();
        ctx.arc(w/2, h/2, w*0.4, 0, 2*Math.PI);
        ctx.fill();
        
        chartLegend.innerHTML = '<div class="legend-item">–ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥</div>';
        return;
      }
      
      // –†–∏—Å—É–µ–º —Å–µ–∫—Ç–æ—Ä—ã
      let startAngle = -Math.PI/2; // –ù–∞—á–∏–Ω–∞–µ–º —Å–≤–µ—Ä—Ö—É
      const colors = cats.map(c => categoryColors[c] || '#a0a0d0');
      
      for (let i = 0; i < cats.length; i++) {
        const sliceAngle = (vals[i] / total) * 2 * Math.PI;
        
        ctx.beginPath();
        ctx.moveTo(w/2, h/2);
        ctx.arc(w/2, h/2, w*0.4, startAngle, startAngle + sliceAngle);
        ctx.closePath();
        
        ctx.fillStyle = colors[i];
        ctx.fill();
        
        ctx.strokeStyle = '#0f142a';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        startAngle += sliceAngle;
      }
      
      // –†–∏—Å—É–µ–º —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—É—é "–¥—ã—Ä–∫—É"
      ctx.beginPath();
      ctx.arc(w/2, h/2, w*0.15, 0, 2*Math.PI);
      ctx.fillStyle = '#0f142a';
      ctx.fill();
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–µ–≥–µ–Ω–¥—É
      let legendHtml = '';
      cats.forEach((category, i) => {
        const percentage = Math.round((vals[i] / total) * 100);
        legendHtml += `
          <div class="legend-item">
            <span class="legend-color" style="background:${colors[i]}"></span>
            ${category} (${percentage}%)
          </div>
        `;
      });
      chartLegend.innerHTML = legendHtml;
    }

    // --- —É–º–Ω—ã–π –±—é–¥–∂–µ—Ç ---
    function updateBudgetAdvice() {
      const salaryStr = salaryInput.value.trim();
      if (!salaryStr) {
        budgetMessage.innerHTML = '<span>‚ö°</span> –£–∫–∞–∂–∏—Ç–µ –∑–∞—Ä–ø–ª–∞—Ç—É –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –±—é–¥–∂–µ—Ç–∞';
        return;
      }
      
      const salary = parseFloat(salaryStr.replace(',', '.'));
      if (salary <= 0) { 
        budgetMessage.innerHTML = '<span>‚ö†Ô∏è</span> –ó–∞—Ä–ø–ª–∞—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª—å—à–µ 0';
        return; 
      }

      const nextStr = nextSalaryDate.value;
      if (!nextStr) {
        budgetMessage.innerHTML = '<span>üìÖ</span> –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É —Å–ª–µ–¥—É—é—â–µ–π –∑–∞—Ä–ø–ª–∞—Ç—ã';
        return;
      }
      
      const next = new Date(nextStr);
      const today = new Date();
      today.setHours(0,0,0,0);
      next.setHours(0,0,0,0);
      
      const diffTime = next - today;
      if (diffTime <= 0) { 
        budgetMessage.innerHTML = '<span>üìÜ</span> –î–∞—Ç–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º';
        return; 
      }
      
      const diffDays = Math.ceil(diffTime / (1000*60*60*24));
      if (diffDays > 31) {
        budgetMessage.innerHTML = '<span>üí°</span> –ü–µ—Ä–∏–æ–¥ –±–æ–ª—å—à–µ –º–µ—Å—è—Ü–∞. –£–∫–∞–∂–∏—Ç–µ –¥–∞—Ç—É –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –º–µ—Å—è—Ü–∞';
        return;
      }

      // –°—á–∏—Ç–∞–µ–º —Ä–∞—Å—Ö–æ–¥—ã —Å –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—Ü–∞
      const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
      const expensesThisMonth = transactions
        .filter(t => t.type === 'expense' && new Date(t.date) >= firstDay)
        .reduce((sum, t) => sum + t.amount, 0);

      const remaining = salary - expensesThisMonth;
      const target = 5000;
      const available = remaining - target;

      if (available < 0) {
        budgetMessage.innerHTML = `
          <span>‚ö†Ô∏è</span> –ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥! 
          <div>–û—Å—Ç–∞—Ç–æ–∫: ${format(remaining)} (—Ü–µ–ª—å ${format(target)})</div>
          <div style="margin-top:4px">–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –Ω–∞ ${format(-available)}</div>
        `;
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –ø—Ä–æ–∏–∑–æ—à–µ–ª —Å–µ–≥–æ–¥–Ω—è
        const lastExpenseToday = transactions.some(t => 
          t.type === 'expense' && 
          t.date === getTodayString() &&
          t.amount > Math.abs(available)
        );
        
        if (lastExpenseToday && Notification.permission === 'granted') {
          showNotification(`–ë—é–¥–∂–µ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω! –ü–µ—Ä–µ—Ä–∞—Å—Ö–æ–¥ –Ω–∞ ${format(-available)}`, 'warning', true);
        }
      } else {
        const daily = available / diffDays;
        budgetMessage.innerHTML = `
          <span>üìÖ</span> –û—Å—Ç–∞–ª–æ—Å—å ${diffDays} –¥–Ω. 
          <div>–ú–æ–∂–Ω–æ —Ç—Ä–∞—Ç–∏—Ç—å <strong>${format(Math.max(0, daily))}</strong>/–¥–µ–Ω—å,</div>
          <div>—á—Ç–æ–±—ã –æ—Å—Ç–∞–ª–æ—Å—å ${format(target)}</div>
        `;
      }
    }

    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    if (Notification.permission === 'default') {
      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          console.log('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã');
        }
      });
    }

    // --- –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ---
    function showNotification(message, type = 'info', systemNotification = false) {
      // –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      if (systemNotification && Notification.permission === 'granted') {
        try {
          new Notification('–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Ç—Ä–µ–∫–µ—Ä', {
            body: message,
            icon: 'https://cdn-icons-png.flaticon.com/512/25/25694.png',
            badge: 'https://cdn-icons-png.flaticon.com/512/25/25694.png'
          });
        } catch (e) {
          console.log('–û—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', e);
        }
      }
      
      // –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      notificationText.textContent = message;
      
      // –ò–∫–æ–Ω–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
      switch(type) {
        case 'success':
          notificationIcon.textContent = '‚úÖ';
          notification.className = 'notification success';
          break;
        case 'error':
          notificationIcon.textContent = '‚ùå';
          notification.className = 'notification error';
          break;
        case 'warning':
          notificationIcon.textContent = '‚ö†Ô∏è';
          notification.className = 'notification warning';
          break;
        default:
          notificationIcon.textContent = '‚ÑπÔ∏è';
          notification.className = 'notification';
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      notification.classList.add('show');
      
      // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // --- OCR —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ ---
    setupButton(scanBtn, () => { 
      receiptImage.click(); 
    });

    receiptImage.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å 5–ú–ë)
      if (file.size > 5 * 1024 * 1024) {
        showNotification('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º 5–ú–ë', 'error');
        receiptImage.value = '';
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
      if (!file.type.match('image.*')) {
        showNotification('–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ', 'error');
        receiptImage.value = '';
        return;
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      ocrResultDiv.innerHTML = '<div class="ocr-loading">–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ–∫–∞...</div>';
      
      try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        document.getElementById('loadingScreen').classList.add('show');
        document.getElementById('loadingScreen').querySelector('.loading-text').textContent = '–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å —á–µ–∫–∞...';
        
        const { data: { text } } = await Tesseract.recognize(file, 'rus+eng', {
          logger: m => console.log(m)
        });
        
        // –°–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
        document.getElementById('loadingScreen').classList.remove('show');
        
        // –û–±—Ä–µ–∑–∞–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const previewText = text.substring(0, 80).replace(/\s+/g, ' ').trim() + (text.length > 80 ? '...' : '');
        ocrResultDiv.textContent = previewText;
        
        // –ò—â–µ–º —Å—É–º–º—É –≤ —Ç–µ–∫—Å—Ç–µ
        const amountMatch = text.match(/(?:–∏—Ç–æ–≥–æ|—Å—É–º–º–∞|–∫ –æ–ø–ª–∞—Ç–µ|total|amount|–æ–ø–ª–∞—á–µ–Ω–æ)\s*[=:]*\s*(\d+[\.,]?\d*)/i) || 
                           text.match(/(\d+[\.,]\d+)\s*—Ä—É–±/i) || 
                           text.match(/(\d+)\s*—Ä—É–±/i);
        
        if (amountMatch) {
          // –ò–∑–≤–ª–µ–∫–∞–µ–º —Å—É–º–º—É
          let sumStr = amountMatch[1] || amountMatch[2] || amountMatch[3] || amountMatch[0];
          sumStr = sumStr.replace(/\s/g, '').replace(',', '.');
          
          // –£–±–∏—Ä–∞–µ–º –≤—Å—ë –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä –∏ —Ç–æ—á–∫–∏
          sumStr = sumStr.replace(/[^\d.]/g, '');
          
          const sum = parseFloat(sumStr);
          if (!isNaN(sum) && sum > 0) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—É–º–º—É –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            amountInput.value = sum.toFixed(2);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
            const cat = guessCategory(text);
            if (cat && currentType !== 'income') {
              categorySelect.value = cat;
              setActiveType('expense');
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ
            descInput.value = '–ß–µ–∫ ' + new Date().toLocaleDateString('ru-RU', {
              day: '2-digit',
              month: '2-digit'
            });
            
            // –§–æ–∫—É—Å –Ω–∞ –∫–Ω–æ–ø–∫–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            setTimeout(() => {
              addBtn.focus();
            }, 100);
            
            ocrResultDiv.innerHTML = `‚úÖ –°—É–º–º–∞: ${format(sum)}<br>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${cat || '–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞'}`;
            showNotification(`–†–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ —Å—É–º–º–∞ ${format(sum)}`, 'success');
          } else {
            ocrResultDiv.innerHTML = '‚ö†Ô∏è –°—É–º–º–∞ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ';
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å—É–º–º—É', 'warning');
          }
        } else {
          ocrResultDiv.innerHTML = '‚ö†Ô∏è –°—É–º–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ç–µ–∫—Å—Ç–µ';
          showNotification('–°—É–º–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ —á–µ–∫–µ', 'warning');
        }
      } catch (err) {
        document.getElementById('loadingScreen').classList.remove('show');
        console.error('OCR Error:', err);
        ocrResultDiv.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è';
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ —á–µ–∫–∞: ' + (err.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
      }
      
      // –û—á–∏—â–∞–µ–º –∏–Ω–ø—É—Ç –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —Ç–æ–≥–æ –∂–µ —Ñ–∞–π–ª–∞
      receiptImage.value = '';
    });

    function guessCategory(text) {
      const t = text.toLowerCase();
      
      if (/(–µ–¥–∞|–ø—Ä–æ–¥—É–∫—Ç|–ø–æ–∫—É–ø–∫–∞ –≤|–º–∞–≥–Ω–∏—Ç|–ø—è—Ç—ë—Ä–æ—á–∫|–ª–µ–Ω—Ç–∞|–∞–∑–±—É–∫–∞ –≤–∫—É—Å–∞|–ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫|–º–µ—Ç—Ä–æ|–≥–∏–ø–µ—Ä–º–∞—Ä–∫–µ—Ç|—Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç)/i.test(t)) return '–ï–¥–∞';
      if (/(—Ç–∞–∫—Å–∏|—è–Ω–¥–µ–∫—Å —Ç–∞–∫—Å–∏|—Å–∏—Ç–∏–º–æ–±–∏–ª|—É–±–µ—Ä|bolt|bolt.eu|–≤–æ–¥–Ω–∏–∫|–≤–æ–¥–∏—Ç–µ–ª—å|–ø–æ–µ–∑–¥–∫–∞|–¥–æ—Å—Ç–∞–≤–∫–∞|–∫—É—Ä—å–µ—Ä|—Å–∞–º–æ–∫–∞—Ç|–≤–µ–ª–æ—Å–∏–ø–µ–¥)/i.test(t)) return '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç';
      if (/(–æ–¥–µ–∂–¥–∞|–æ–±—É–≤—å|wildberries|ozon|–ª–∞–º–æ–¥–∞|–∑–∞—Ä–∏–Ω–∞|–±–µ—Ä—É|—Å–±–µ—Ä–º–µ–≥–∞–º–∞—Ä–∫–µ—Ç|–∞–ª–∏—ç–∫—Å–ø—Ä–µ—Å—Å|–∞–ª–∏–±–∞–±–∞|aliexpress|ali)/i.test(t)) return '–ü–æ–∫—É–ø–∫–∏';
      if (/(–∫–∏–Ω–æ|—Ç–µ–∞—Ç—Ä|–∫–æ–Ω—Ü–µ—Ä—Ç|–º—É–∑–µ–π|–≤—ã—Å—Ç–∞–≤–∫–∞|–∫–∞—Ñ–µ|—Ä–µ—Å—Ç–æ—Ä–∞–Ω|–±–∞—Ä|–ø–∞–±|–±–æ—É–ª–∏–Ω–≥|–±–∏–ª—å—è—Ä–¥|—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏|–¥–æ—Å—É–≥)/i.test(t)) return '–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è';
      if (/(–∂–∫—Ö|–∫–æ–º–º—É–Ω–∞–ª|—ç–ª–µ–∫—Ç—Ä–æ|—Å–≤–µ—Ç|–≥–∞–∑|–≤–æ–¥–∞|–æ—Ç–æ–ø–ª–µ–Ω–∏–µ|–∏–Ω—Ç–µ—Ä–Ω–µ—Ç|—Ç–≤|—Ç–µ–ª–µ—Ñ–æ–Ω|–º—Ç—Å|–±–∏–ª–∞–π–Ω|–º–µ–≥–∞—Ñ–æ–Ω|tele2)/i.test(t)) return '–ö–æ–º–º—É–Ω–∞–ª–∫–∞';
      if (/(–∞–ø—Ç–µ–∫–∞|–ª–µ–∫–∞—Ä—Å—Ç–≤–æ|–∑–¥–æ—Ä–æ–≤—å–µ|–≤—Ä–∞—á|–∫–ª–∏–Ω–∏–∫–∞|–±–æ–ª—å–Ω–∏—Ü–∞|–ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞|—Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏—è)/i.test(t)) return '–ó–¥–æ—Ä–æ–≤—å–µ';
      
      return '–î—Ä—É–≥–æ–µ';
    }

    // –°–æ–±—ã—Ç–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±—é–¥–∂–µ—Ç–∞
    salaryInput.addEventListener('input', updateBudgetAdvice);
    nextSalaryDate.addEventListener('input', updateBudgetAdvice);
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ —Å—É–º–º—ã (–∑–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É –ø—Ä–∏ –≤–≤–æ–¥–µ)
    amountInput.addEventListener('input', function(e) {
      let value = e.target.value;
      // –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, —Ç–æ—á–∫—É –∏ –∑–∞–ø—è—Ç—É—é
      value = value.replace(/[^0-9.,]/g, '');
      // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É
      value = value.replace(',', '.');
      // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ —Ç–æ—á–∫–∏
      if (value.includes('.')) {
        const parts = value.split('.');
        if (parts[1] && parts[1].length > 2) {
          value = parts[0] + '.' + parts[1].substring(0, 2);
        }
      }
      e.target.value = value;
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã
    salaryInput.addEventListener('input', function(e) {
      let value = e.target.value;
      value = value.replace(/[^0-9]/g, '');
      e.target.value = value;
    });

    // Enter –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
    descInput.addEventListener('keydown', (e) => { 
      if (e.key === 'Enter') {
        e.preventDefault();
        amountInput.focus();
      }
    });
    
    amountInput.addEventListener('keydown', (e) => { 
      if (e.key === 'Enter') {
        e.preventDefault();
        addTransaction();
      }
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
    setTimeout(() => {
      descInput.focus();
    }, 500);

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    load();
    updateUI();
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
    if (!localStorage.getItem('finance_app_visited')) {
      setTimeout(() => {
        showNotification('üí° –°–æ–≤–µ—Ç: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–°–Ω—è—Ç—å —á–µ–∫", —á—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å—É–º–º—É —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —á–µ–∫–∞', 'info');
      }, 2000);
      localStorage.setItem('finance_app_visited', 'true');
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    window.addEventListener('error', (e) => {
      console.error('Global error:', e);
      if (!e.defaultPrevented) {
        showNotification('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.', 'error');
      }
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø—Ä–æ–º–∏—Å–æ–≤
    window.addEventListener('unhandledrejection', (e) => {
      console.error('Unhandled rejection:', e.reason);
      showNotification('–û—à–∏–±–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏: ' + (e.reason?.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'), 'error');
      e.preventDefault();
    });
  })();
</script>

<!-- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä–∞ –¥–ª—è PWA -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('SW registered'))
        .catch(err => console.log('SW registration failed'));
    });
  }
</script>
</body>
</html>